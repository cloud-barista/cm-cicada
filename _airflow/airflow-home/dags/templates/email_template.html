{% set result = ti.xcom_pull(task_ids='collect_failed_tasks') %}
{% set dag_id = result.get('dag_id') %}
{% set exec_date = dag_run.execution_date | urlencode %}
{% set failed_tasks = result.get('failed_tasks') %}

<h3>ğŸ“‹ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ìƒíƒœ ë³´ê³ ì„œ</h3>

<table style="border-collapse: collapse; width: 100%;">
  <tr>
    <th style="text-align: left; border-bottom: 1px solid #ddd;">í•­ëª©</th>
    <th style="text-align: left; border-bottom: 1px solid #ddd;">ê°’</th>
  </tr>
  <tr>
    <td><strong>ì›Œí¬í”Œë¡œìš° ID</strong></td>
    <td>{{ dag_id }}</td>
  </tr>
  <tr>
    <td><strong>ì›Œí¬í”Œë¡œìš° Run ID</strong></td>
    <td>{{ result.get('dag_run_id') }}</td>
  </tr>
  <tr>
    <td><strong>ì‹¤í–‰ ìƒíƒœ</strong></td>
    <td>{{ result.get('dag_state') }}</td>
  </tr>
</table>

{% if failed_tasks %}
<br>
<h4 style="color:red;">âŒ ì‹¤íŒ¨í•œ Task ëª©ë¡</h4>
<ul>
  {% for task_id in failed_tasks %}
  <li>
    {{ task_id }}<br>
    <a href="http://192.168.160.250:8080/dags/{{ dag_id }}/grid?task_id={{ task_id }}&execution_date={{ exec_date }}"
      target="_blank">ğŸ” ë¡œê·¸ ë³´ê¸°</a>
  </li>
  {% endfor %}
</ul>
{% else %}
<br>
<p>âœ… ëª¨ë“  Taskê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
{% endif %}